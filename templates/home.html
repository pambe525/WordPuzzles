{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="page-title">Dashboard</div>
    <hr class="dark-line">

    <!-- NOTIFICATIONS SECTION -->
    <div class="boxed-panel bg-lemon m-top">
        <div class="subtitle"><i class="fa-solid fa-bell r-space"></i>My Notifications</div>
        <hr>
        <div class="note-text">No notifications to report.</div>
    </div>
    <br>

    <!-- Draft Puzzles tab content -->
    <div class="boxed-panel bg-gray m-top">
        <div class="flex">
            <i class="fa-solid fa-compass-drafting r-space"></i>
            <div class="subtitle">My Draft Puzzles</div>
            <button id="btnCreatePuzzle" class="blue-btn r-float">Create Puzzle</button>
        </div>
        <hr>
        {% if draft_puzzles|length == 0 %}
            <div class="note-text">No draft puzzles.</div>
        {% else %}
            <div id="drafts-list" class="m-top">
            </div>
        {% endif %}
    </div>

    <!-- New Puzzle Dialog -->
    <dialog class="modal-dialog" id="new-puzzle-dialog">
        <div class="subtitle">New Puzzle</div>
        <hr>
        <form action="{% url 'new_puzzle' %}" method="post">
            {% csrf_token %}
            <table>{{ form.as_table }}</table>
            <button type="submit" class="blue-btn">Create Puzzle</button>
            <button id="btnClose" formmethod="dialog">Cancel</button>
        </form>
    </dialog>

    <script src="{% static '/javascript/puzzles_list_builder.js' %}"></script>
    <script>
        const draftPuzzles = {{ draft_puzzles | safe }};
        const imgDirPath = "{% static '/images/' %}";
        const baseUrl = "{{ request.get_host }}";

        function pageInit() {
            bindModalDialogToButton("new-puzzle-dialog", "btnCreatePuzzle");
            try {
                let builder = new PuzzlesListBuilder(draftPuzzles, imgDirPath, baseUrl);
                builder.buildBadges();
                builder.addDeleteBtns(showConfirmDialog);
                builder.showList("drafts-list");
            } catch (e) {
                console.log(e);
            }
        }

        function showConfirmDialog(event) {
            const element = event.target
            const dialog = document.getElementById("confirm-dialog")
            const puzzleId = element.getAttribute("data-id");
            const url = "/delete_puzzle/" + puzzleId + "/";
            dialog.getElementsByClassName("confirm-dialog-form")[0].setAttribute('action', url)
            dialog.getElementsByClassName("subtitle")[0].textContent =
                "Delete Puzzle " + puzzleId;
            dialog.getElementsByClassName("confirm-dialog-message")[0].textContent =
                "This puzzle and all associated clues will be permanently deleted " +
                "This action cannot be undone. Please confirm."
            dialog.showModal();
        }
    </script>
{% endblock %}
