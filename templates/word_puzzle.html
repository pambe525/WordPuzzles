{% extends "base.html" %}
{% block content %}
    <div class="d-inline-block">
        <h2 class="pl-2 pb-0 mb-2 mt-2">{{ heading }}</h2>
        <div class="m-1 bg-light p-3">
            <h4 class="mb-0"><b>{{ object }}</b></h4>
            {% if object.is_published %}
                <h6 class="mb-2 mt-1 text-secondary" id="id-posted-by">
                    Posted by: <b>{{ object.editor }}</b> on {{ object.shared_at|date:'M d, Y' }} (GMT)
                </h6>
            {% endif %}
            {% if object.desc != None and object.desc != "" %}
                <h6 class="text-dark mb-3" id="id-desc">Description: {{ object.desc }}</h6>
            {% endif %}
            {% if object.size == 0 %}
                <div class="mt-2 notetext">No clues exist.</div>
            {% else %}
                <h5 class="mb-0"><b>Clues</b></h5>
                <div class="notetext">Click on a clue number button below to view the clue.</div>
                <!-- CLUE BUTTONS -->
                <div class="mt-1 mb-2">
                    {% for clue in object.get_clues %}
                        <button class="btn-sm btn-light border border-secondary pt-0 pb-0"
                                id = "clue-btn-{{ clue.clue_num }}"
                                onclick = "showClue(this.innerText);"
                                title="{{ clue.get_decorated_clue_text }} [{{ clue.points }} pts]">
                                {{ clue.clue_num }}
                        </button>
                    {% endfor %}
                </div>
                <!-- CLUE ROTATOR -->
                <div class="m-0 row align-items-center">
                    <button class="pr-2 p-0 btn" title="Previous clue" id="id-left-caret" onclick="prevClue();">
                        <i class="fa fa-caret-left fa-3x"></i>
                    </button>
                    <div class="col p-2 border border-dark rounded-3" style="line-height:18px">
                        <div class="font-weight-bold mb-2" id="id-clue"></div>
                        <div id="id-answer"></div>
                        <div class="mt-1" id="id-parsing"></div>
                    </div>
                    <button class="pl-2 p-0 btn" title="Next clue" id="id-right-caret" onclick="nextClue();">
                        <i class="fa fa-caret-right fa-3x"></i>
                    </button>
                </div>
            {% endif %}
            <hr>
            {% if session is None %}
            <div class="m-0 row mt-2">
                {% if object.size != 0 %}
                    {% if not object.is_published and request.user == object.editor %}
                        <a class="btn btn-primary" href="{% url 'publish_puzzle' object.id %}">PUBLISH</a>
                    {% endif %}
                    {% if object.is_published and request.user == object.editor %}
                        <a class="btn btn-primary" href="{% url 'unpublish_puzzle' object.id %}">UNPUBLISH</a>
                    {% endif %}
                    {% if object.is_published and request.user != object.editor %}
                        <a class="btn btn-primary" href="{% url 'solve_puzzle' object.id %}">SOLVE NOW</a>
                    {% endif %}
                {% endif %}
                <a class="ml-auto btn btn-dark" href="/">DONE</a>
            </div>
            {% else %}
                <div class="m-0 row">
                    <div id="id-score"></div>
                    <div id="id-progress"></div>
                    <div id="id-timer"></div>
                </div>
                <a class="ml-auto btn btn-dark" href="/">FINISH LATER</a>
            {% endif %}
            {% if object.size != 0 and not object.is_published and request.user == object.editor %}
                <div class="notetext pt-2">
                    NOTE: Publish your puzzle only after all clues are complete. Published puzzles cannot be edited
                    and will be accessible to all puzzlers to solve.  Unpublish the puzzle to edit.
                </div>
            {% endif %}
            {% if object.size != 0 and object.is_published and request.user == object.editor %}
                <div class="notetext pt-2">
                    NOTE: Unpublish your puzzle only if you wish to make critical edits or delete the puzzle.
                    Unpublished puzzle will not be accessible to puzzlers and will put it in draft mode with
                    restricted editing.
                </div>
            {% endif %}
        </div>
    </div>
    <script>
        const clueSet = {{ clues | safe }};
        const puzzleSession = {{ session | safe }}
        const showAnswers = {{ show_answers | yesno:'true, false' | safe }};
    </script>
    {% load static %}
    <script src="{% static '/javascript/word_puzzle_view.js' %}"></script>
{% endblock %}